(window.webpackJsonp=window.webpackJsonp||[]).push([[434],{2191:function(e,n,t){"use strict";t.r(n);var r=t(1),d=(t(23),t(16),t(19),t(22)),o=t.n(d),l=t(140),c=t(179),m=t(21),v="Register",w="Login",f=t(386),h=t(345);function y(){return $.apply(this,arguments)}function $(){return $=Object(r.a)(regeneratorRuntime.mark((function e(){var n,t,r,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>0&&void 0!==d[0]?d[0]:0,m.a.debug("Handling UserSignup UTM params"),!(n>30)){e.next=6;break}throw new Error("Failed to set up user");case 6:n++;case 7:return e.next=9,new Promise((function(e){return setTimeout(e,1e3)}));case 9:if(t=window.$nuxt.$api){e.next=12;break}return e.abrupt("return");case 12:if(r={utm_source:o.a.get("utm_source")||"empty",utm_medium:o.a.get("utm_medium")||"(not set)",utm_campaign:o.a.get("utm_campaign")||void 0,currency:o.a.get("currency")||null,language:o.a.get("language")||void 0,cobrand:o.a.get(f.a)||void 0},0!==Object.keys(r).length){e.next=15;break}return e.abrupt("return");case 15:return e.prev=15,e.next=18,t.patch("/api/v3/users/me",r);case 18:e.next=26;break;case 20:if(e.prev=20,e.t0=e.catch(15),e.t0.response){e.next=24;break}throw e.t0;case 24:if(404!==e.t0.response.status){e.next=26;break}return e.abrupt("return",y(n));case 26:case"end":return e.stop()}}),e,null,[[15,20]])}))),$.apply(this,arguments)}c.a.$on(l.a.UserSignedIn,(function(e){var n,t,r,d,v,f,y=e.user,$=e.method,x=e.enterprise,k=e.track_analytics,U=void 0===k||k;(m.a.debug("Handling UserSignedIn",y),h.b.identify(y.id),U&&(h.b.track(h.a.LOGIN,{method:$}),c.a.$emit(l.a.AnalyticsGA4Event,{event:"login",userId:y.id,method:$})),null===(n=window.$nuxt)||void 0===n||null===(t=n.$sentry)||void 0===t||t.setUser({id:y.id,email:y.email}),null===(r=window.$nuxt)||void 0===r||null===(d=r.$mixpanel)||void 0===d||d.identify(y.id),null===(v=window.$nuxt)||void 0===v||null===(f=v.$mixpanel)||void 0===f||f.track(w),x.is_whitelabel)||(o.a.get("currency")!==y.currency&&(o.a.set("currency",y.currency),c.a.$emit(l.a.CurrencyChange,y.currency)),o.a.remove("unauthed_cart"))})),c.a.$on(l.a.UserRegistered,function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(n){var t,r,d,w,f,$,x,k,U;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x=n.user,k=n.method,U=n.enterprise,m.a.debug("Handling UserRegistered",x),h.b.identify(x.id),y().catch((function(e){return m.a.error(e)})),c.a.$emit(l.a.AnalyticsGA4Event,{event:"sign_up",userId:x.id,method:k}),h.b.track(h.a.REGISTER,{method:k}),null===(t=window.$nuxt)||void 0===t||null===(r=t.$sentry)||void 0===r||r.setUser({id:x.id,email:x.email}),null===(d=window.$nuxt)||void 0===d||null===(w=d.$mixpanel)||void 0===w||w.identify(x.id),null===(f=window.$nuxt)||void 0===f||null===($=f.$mixpanel)||void 0===$||$.track(v),o.a.remove("unauthed_cart"),!U.is_whitelabel){e.next=12;break}return e.abrupt("return");case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),c.a.$on(l.a.UserUpdatedAttributes,(function(e){var n,t,r=e.user,d=e.enterprise;m.a.debug("Handling UserUpdatedAttributes",r),o.a.remove("unauthed_cart"),d.is_whitelabel||(r.given_name||r.family_name)&&(null===(n=window.$nuxt)||void 0===n||null===(t=n.$sentry)||void 0===t||t.setUser({id:r.id,email:r.email}))})),c.a.$on(l.a.UserSignedOut,(function(e){var n,t,r=e.enterprise;m.a.debug("Handling UserSignedOut"),null===(n=window.$nuxt)||void 0===n||null===(t=n.$sentry)||void 0===t||t.setUser(null),r.is_whitelabel||h.b.track(h.a.LOGOUT)}))}}]);
//# sourceMappingURL=86a96c2.js.map